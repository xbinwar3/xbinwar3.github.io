<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker åŸç†å…¨æ™¯æ•™å­¦å¹³å°</title>
    <style>
        :root {
            --bg-dark: #1a1b26;
            --bg-panel: #24283b;
            --primary: #7aa2f7;
            --secondary: #bb9af7;
            --success: #9ece6a;
            --warning: #e0af68;
            --danger: #f7768e;
            --text-main: #c0caf5;
            --text-dim: #565f89;
            --border: #414868;
            --term-bg: #101014;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Navigation --- */
        nav {
            background: #16161e;
            padding: 0 20px;
            height: 60px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 100;
        }

        .logo {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary);
            margin-right: 40px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-btn {
            background: transparent;
            border: none;
            color: var(--text-dim);
            padding: 0 20px;
            height: 60px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
        }

        .nav-btn:hover { color: var(--text-main); background: rgba(255,255,255,0.05); }
        .nav-btn.active { color: var(--primary); border-bottom-color: var(--primary); }

        /* --- Main Content Area --- */
        main {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .view-section {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            overflow-y: auto;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .view-section.active {
            display: block;
            opacity: 1;
        }

        /* --- View 1: Theory (Scrollable) --- */
        .theory-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .card {
            background: var(--bg-panel);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }

        h1, h2, h3 { color: var(--text-main); margin-top: 0; }
        h2 { border-bottom: 2px solid var(--border); padding-bottom: 10px; color: var(--primary); }
        
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .concept-box {
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--secondary);
        }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid var(--border); }
        th { color: var(--primary); }

        /* --- View 2: Lab (Split Screen) --- */
        .lab-layout {
            display: flex;
            height: 100%;
        }

        .visual-pane {
            flex: 1;
            background: linear-gradient(135deg, #1f2335 0%, #1a1b26 100%);
            border-right: 2px solid var(--border);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end; /* From bottom up */
            padding-bottom: 60px;
        }

        .terminal-pane {
            flex: 1;
            background: var(--term-bg);
            display: flex;
            flex-direction: column;
            padding: 20px;
            font-family: 'Consolas', monospace;
        }

        /* Lab Animation Elements */
        .kernel-floor {
            width: 100%;
            height: 50px;
            background: #2e3c64;
            color: #7aa2f7;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            position: absolute;
            bottom: 0;
            z-index: 10;
        }

        .container-wrapper {
            position: relative;
            width: 320px;
            height: 350px;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            margin-bottom: 20px;
        }

        .fs-layer {
            width: 240px;
            height: 20px;
            background: var(--secondary);
            margin-bottom: 4px;
            border-radius: 4px;
            position: absolute;
            bottom: 0;
            opacity: 0;
            transform: translateY(50px);
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            color: #000;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .process-node {
            width: 70px;
            height: 70px;
            background: var(--success);
            border-radius: 50%;
            position: absolute;
            bottom: 100px;
            transform: scale(0);
            transition: all 0.5s;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #1a1b26;
            font-weight: bold;
            font-size: 12px;
            z-index: 5;
            box-shadow: 0 0 20px rgba(158, 206, 106, 0.4);
        }

        .wall {
            position: absolute;
            background: rgba(122, 162, 247, 0.15);
            border: 2px dashed var(--primary);
            transition: all 0.8s;
            opacity: 0;
            z-index: 2;
        }
        .wall-left { width: 0; height: 300px; bottom: 0; left: 20px; border-right: none;}
        .wall-right { width: 0; height: 300px; bottom: 0; right: 20px; border-left: none;}
        .wall-top { width: 280px; height: 0; bottom: 300px; left: 20px; border-bottom: none;}

        .cgroup-press {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) translateY(-50px);
            background: var(--danger);
            color: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            opacity: 0;
            transition: all 0.5s;
            z-index: 20;
            font-size: 12px;
        }

        /* Lab Terminal */
        .term-screen {
            flex: 1;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.6;
            color: #fff;
            margin-bottom: 20px;
            scrollbar-width: thin;
        }
        .term-line { margin-bottom: 5px; }
        .prompt { color: var(--success); margin-right: 8px; }
        .cmd { color: var(--primary); }
        .output { color: var(--text-dim); white-space: pre-wrap; padding-left: 10px; border-left: 2px solid #333; margin-top: 4px;}
        
        .cursor {
            display: inline-block;
            width: 8px;
            height: 15px;
            background: #fff;
            animation: blink 1s infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }

        .lab-controls {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }
        .lab-btn {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            color: var(--text-dim);
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        .lab-btn:hover { background: #333; }
        .lab-btn.active { border-color: var(--primary); color: var(--primary); background: rgba(122,162,247,0.1); }
        .lab-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        /* --- View 3: Analysis (Split List) --- */
        .analysis-layout {
            display: flex;
            height: 100%;
        }
        
        .cmd-list {
            flex: 1;
            background: var(--term-bg);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            padding: 20px;
        }

        .cmd-block {
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #333;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .cmd-block:hover { border-color: var(--primary); background: rgba(255,255,255,0.03); }
        .cmd-block.selected { border-color: var(--primary); background: rgba(122,162,247,0.1); box-shadow: 0 0 15px rgba(122,162,247,0.1); }

        .detail-pane {
            flex: 1;
            background: var(--bg-panel);
            padding: 40px;
            overflow-y: auto;
        }

        .code-tag {
            background: #000;
            color: var(--warning);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
        }

    </style>
</head>
<body>

<nav>
    <div class="logo">ğŸ³ Docker Internals Hub</div>
    <button class="nav-btn active" onclick="switchView('theory')">1. æ ¸å¿ƒåŸç†è¯¾</button>
    <button class="nav-btn" onclick="switchView('lab')">2. äº¤äº’å®éªŒå®¤ (æ¨¡æ‹Ÿ)</button>
    <button class="nav-btn" onclick="switchView('analysis')">3. æºç çº§è§£å‰– (Forensics)</button>
</nav>

<main>

    <!-- è§†å›¾ 1ï¼šæ ¸å¿ƒåŸç† -->
    <div id="view-theory" class="view-section active">
        <div class="theory-container">
            <div class="card">
                <h1>Docker åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h1>
                <p>Docker å®¹å™¨æœ¬è´¨ä¸Šæ˜¯<strong>å®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªç‰¹æ®Šè¿›ç¨‹</strong>ã€‚å®ƒå¹¶æ²¡æœ‰åˆ›é€ æ–°çš„ç¡¬ä»¶è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œè€Œæ˜¯åˆ©ç”¨ Linux å†…æ ¸çš„ç‰¹æ€§ï¼Œç»™è¿›ç¨‹æˆ´ä¸Šäº†â€œVRçœ¼é•œâ€ï¼ˆNamespacesï¼‰å’Œâ€œæ‰‹é“â€ï¼ˆCgroupsï¼‰ã€‚</p>
                <div style="text-align:center; padding: 20px; background:#1e2030; border-radius:8px; margin: 20px 0;">
                    <strong style="font-size: 1.2rem; color: var(--success);">å®¹å™¨ = Namespaces (éš”ç¦») + Cgroups (é™åˆ¶) + UnionFS (é•œåƒ)</strong>
                </div>
            </div>

            <div class="card">
                <h2>1. Namespaces (éš”ç¦»æœºåˆ¶)</h2>
                <p>Namespaces è®©è¿›ç¨‹äº§ç”Ÿâ€œå¹»è§‰â€ï¼Œä»¥ä¸ºè‡ªå·±ç‹¬å äº†æ“ä½œç³»ç»Ÿã€‚</p>
                <table>
                    <tr><th>ç±»å‹</th><th>éš”ç¦»å†…å®¹</th><th>Docker æ•ˆæœ</th></tr>
                    <tr><td><strong>PID</strong></td><td>è¿›ç¨‹ç¼–å·</td><td>å®¹å™¨å†…è¿›ç¨‹ PID ä¸º 1ï¼Œçœ‹ä¸åˆ°å®¿ä¸»æœºè¿›ç¨‹ã€‚</td></tr>
                    <tr><td><strong>NET</strong></td><td>ç½‘ç»œè®¾å¤‡/ç«¯å£</td><td>æ¯ä¸ªå®¹å™¨æœ‰ç‹¬ç«‹çš„ eth0 IPï¼Œç«¯å£ä¸å†²çªã€‚</td></tr>
                    <tr><td><strong>MNT</strong></td><td>æ–‡ä»¶æŒ‚è½½ç‚¹</td><td>å®¹å™¨æœ‰ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿï¼Œçœ‹ä¸è§å®¿ä¸»æœºæ–‡ä»¶ã€‚</td></tr>
                    <tr><td><strong>UTS</strong></td><td>ä¸»æœºå</td><td>å®¹å™¨æœ‰è‡ªå·±çš„ Hostnameã€‚</td></tr>
                </table>
            </div>

            <div class="card">
                <h2>2. Cgroups (èµ„æºæ§åˆ¶)</h2>
                <p>å¦‚æœæ²¡æœ‰ Cgroupsï¼Œä¸€ä¸ªæ­»å¾ªç¯çš„å®¹å™¨ä¼šåƒå…‰æœåŠ¡å™¨ CPUã€‚Cgroups (Control Groups) è´Ÿè´£é™åˆ¶ã€è®°å½•å’Œéš”ç¦»è¿›ç¨‹ç»„æ‰€ä½¿ç”¨çš„ç‰©ç†èµ„æºã€‚</p>
                <div class="concept-grid">
                    <div class="concept-box">
                        <h3>ğŸ”’ èµ„æºé™åˆ¶</h3>
                        <p>é™åˆ¶å†…å­˜ä¸Šé™ï¼ˆå¦‚ 512MBï¼‰ã€‚è¶…è¿‡å³è¢« OOM Killã€‚</p>
                    </div>
                    <div class="concept-box">
                        <h3>âš–ï¸ ä¼˜å…ˆçº§</h3>
                        <p>åˆ†é… CPU æ—¶é—´ç‰‡æƒé‡ï¼Œä¿è¯å…³é”®ä¸šåŠ¡ã€‚</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>3. UnionFS (åˆ†å±‚å­˜å‚¨)</h2>
                <p>Docker é•œåƒç”±å¤šå±‚åªè¯»æ–‡ä»¶ç³»ç»Ÿç»„æˆã€‚è¿è¡Œæ—¶ï¼ŒDocker åªæ˜¯åœ¨æœ€é¡¶å±‚ç›–äº†ä¸€å±‚â€œè¯»å†™å±‚â€ã€‚</p>
                <p><strong>Copy-on-Write (å†™æ—¶å¤åˆ¶)ï¼š</strong> åªæœ‰å½“ä½ ä¿®æ”¹æ–‡ä»¶æ—¶ï¼ŒDocker æ‰ä¼šæŠŠå®ƒä»åªè¯»å±‚å¤åˆ¶ä¸Šæ¥ã€‚è¿™ä½¿å¾—å®¹å™¨å¯åŠ¨åªéœ€æ¯«ç§’çº§ã€‚</p>
            </div>
        </div>
    </div>

    <!-- è§†å›¾ 2ï¼šäº¤äº’å®éªŒå®¤ -->
    <div id="view-lab" class="view-section">
        <div class="lab-layout">
            <!-- å·¦ä¾§åŠ¨ç”» -->
            <div class="visual-pane">
                <div class="cgroup-press" id="anim-cgroup">â¬‡ï¸ Memory Limit: 512MB</div>
                
                <div class="container-wrapper">
                    <!-- å¢™å£ -->
                    <div class="wall wall-left" id="anim-wl"></div>
                    <div class="wall wall-right" id="anim-wr"></div>
                    <div class="wall wall-top" id="anim-wt"></div>

                    <!-- è¿›ç¨‹ -->
                    <div class="process-node" id="anim-proc">
                        <span>PID 1</span>
                        <small>Bash</small>
                    </div>

                    <!-- æ–‡ä»¶å±‚ -->
                    <div class="fs-layer" id="l1" style="bottom: 0px; background: #444; z-index:1; color:#fff;">Host Kernel (Shared)</div>
                    <div class="fs-layer" id="l2" style="bottom: 0px; z-index:2; background: #7aa2f7;">Layer 1: Base OS</div>
                    <div class="fs-layer" id="l3" style="bottom: 0px; z-index:3; background: #bb9af7;">Layer 2: App Libs</div>
                    <div class="fs-layer" id="l4" style="bottom: 0px; z-index:4; background: #f7768e; height: 8px;">Layer 3: RW Layer</div>
                </div>
                <div class="kernel-floor">LINUX HOST KERNEL</div>
            </div>

            <!-- å³ä¾§ç»ˆç«¯ -->
            <div class="terminal-pane">
                <div style="border-bottom: 1px solid #333; padding-bottom:10px; margin-bottom:10px;">
                    <strong>ğŸš€ Docker "å¾’æ‰‹" æ„å»ºå®éªŒå®¤</strong>
                </div>
                <div class="term-screen" id="lab-term">
                    <div class="term-line">Welcome. è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œæ‰‹åŠ¨æ¨¡æ‹Ÿæ„å»ºå®¹å™¨çš„è¿‡ç¨‹ã€‚<br>----------------------------------------</div>
                </div>
                <div class="lab-controls">
                    <button class="lab-btn" id="btn-s1" onclick="runLab(1)">1. ä¸‹è½½é•œåƒ</button>
                    <button class="lab-btn" id="btn-s2" onclick="runLab(2)" disabled>2. å»ºç«‹éš”ç¦»</button>
                    <button class="lab-btn" id="btn-s3" onclick="runLab(3)" disabled>3. åˆ‡æ¢æ ¹ç›®å½•</button>
                    <button class="lab-btn" id="btn-s4" onclick="runLab(4)" disabled>4. èµ„æºé™åˆ¶</button>
                    <button class="lab-btn" id="btn-s5" onclick="runLab(5)" disabled>5. éªŒè¯</button>
                    <button class="lab-btn" onclick="resetLab()" style="border-color: var(--danger); color: var(--danger);">é‡ç½®</button>
                </div>
            </div>
        </div>
    </div>

    <!-- è§†å›¾ 3ï¼šæºç è§£å‰– -->
    <div id="view-analysis" class="view-section">
        <div class="analysis-layout">
            <div class="cmd-list">
                <div style="color: #666; font-size: 0.9em; margin-bottom: 15px;">ç‚¹å‡»ä¸‹æ–¹å‘½ä»¤å—æŸ¥çœ‹è¯¦ç»†åŸç†</div>
                
                <div class="cmd-block selected" onclick="showAnalysis(1)" id="ab-1">
                    <div style="color: var(--danger); font-size: 0.8em;">STEP 1: å‡†å¤‡</div>
                    <div><span class="cmd">tar</span> -xvf alpine.tar -C rootfs/</div>
                </div>

                <div class="cmd-block" onclick="showAnalysis(2)" id="ab-2">
                    <div style="color: var(--danger); font-size: 0.8em;">STEP 2: éš”ç¦»</div>
                    <div><span class="cmd">unshare</span> --pid --net --mount-proc --fork /bin/bash</div>
                </div>

                <div class="cmd-block" onclick="showAnalysis(3)" id="ab-3">
                    <div style="color: var(--danger); font-size: 0.8em;">STEP 3: ç¦é”¢</div>
                    <div><span class="cmd">chroot</span> ./rootfs /bin/sh</div>
                </div>

                <div class="cmd-block" onclick="showAnalysis(4)" id="ab-4">
                    <div style="color: var(--danger); font-size: 0.8em;">STEP 4: é™åˆ¶</div>
                    <div><span class="cmd">echo</span> 100M > memory.limit_in_bytes</div>
                </div>
            </div>

            <div class="detail-pane">
                <div id="ad-1" style="display:block">
                    <h2>Step 1: é•œåƒåªæ˜¯ä¸ªå‹ç¼©åŒ…</h2>
                    <p>Docker é•œåƒæœ¬è´¨ä¸Šå°±æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„å‹ç¼©å½’æ¡£ã€‚</p>
                    <ul>
                        <li><span class="code-tag">tar -xvf</span>: æˆ‘ä»¬æŠŠä¸‹è½½çš„ Alpine Linux æ–‡ä»¶ç³»ç»Ÿè§£å‹åˆ°ä¸€ä¸ªæ™®é€šç›®å½• <code>rootfs/</code> ä¸­ã€‚</li>
                        <li>æ­¤æ—¶ï¼Œå®ƒè¿˜åªæ˜¯ç£ç›˜ä¸Šçš„ä¸€å †æ–‡ä»¶ï¼Œå¹¶ä¸æ˜¯å®¹å™¨ã€‚</li>
                    </ul>
                </div>
                
                <div id="ad-2" style="display:none">
                    <h2>Step 2: Unshare åˆ›é€ å¹³è¡Œå®‡å®™</h2>
                    <p>è¿™æ˜¯ Docker çš„æ ¸å¿ƒé­”æ³•ã€‚<code>unshare</code> è°ƒç”¨ Linux Namespace APIã€‚</p>
                    <ul>
                        <li><span class="code-tag">--pid</span>: åˆ›å»ºç‹¬ç«‹çš„è¿›ç¨‹ç¼–å·ç©ºé—´ã€‚å­è¿›ç¨‹å°†æˆä¸º PID 1ã€‚</li>
                        <li><span class="code-tag">--net</span>: åˆ›å»ºç‹¬ç«‹çš„ç½‘ç»œæ ˆï¼ˆç½‘å¡ã€è·¯ç”±è¡¨ï¼‰ã€‚</li>
                        <li><span class="code-tag">--mount-proc</span>: å…³é”®ï¼é‡æ–°æŒ‚è½½ /procã€‚å¦åˆ™ä½ åœ¨å®¹å™¨é‡Œè¾“å…¥ <code>ps</code> è¿˜æ˜¯ä¼šçœ‹åˆ°å®¿ä¸»æœºè¿›ç¨‹ã€‚</li>
                        <li><span class="code-tag">--fork</span>: å¿…é¡»å¯åŠ¨æ–°è¿›ç¨‹æ¥åº”ç”¨è¿™äº›éš”ç¦»ã€‚</li>
                    </ul>
                </div>

                <div id="ad-3" style="display:none">
                    <h2>Step 3: Chroot æ”¹å˜ä¸–ç•Œè§‚</h2>
                    <p>è™½ç„¶ Namespace éš”ç¦»äº† PIDï¼Œä½†æ–‡ä»¶ç³»ç»Ÿè¿˜æ˜¯å®¿ä¸»æœºçš„ã€‚</p>
                    <ul>
                        <li><span class="code-tag">chroot ./rootfs</span>: å°†è¿›ç¨‹çš„â€œæ ¹ç›®å½• /â€ å¼ºè¡ŒæŒ‡å‘åˆšæ‰è§£å‹çš„æ–‡ä»¶å¤¹ã€‚</li>
                        <li>æ‰§è¡Œåï¼Œè¿›ç¨‹å†ä¹Ÿæ— æ³•è®¿é—® <code>/home/user</code> ç­‰å®¿ä¸»æœºè·¯å¾„ã€‚å®ƒä»¥ä¸ºè‡ªå·±å°±åœ¨æ“ä½œç³»ç»Ÿçš„æœ€é¡¶å±‚ã€‚</li>
                    </ul>
                </div>

                <div id="ad-4" style="display:none">
                    <h2>Step 4: Cgroups æ–½åŠ æ·é”</h2>
                    <p>Namespace è´Ÿè´£éš”ç¦»ï¼ˆçœ‹ä¸è§ï¼‰ï¼ŒCgroups è´Ÿè´£é™åˆ¶ï¼ˆç”¨ä¸äº†ï¼‰ã€‚</p>
                    <ul>
                        <li>Cgroups é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ¥å£å·¥ä½œï¼š<code>/sys/fs/cgroup/...</code></li>
                        <li>åªéœ€å¾€ <code>memory.limit_in_bytes</code> å†™æ•°å­—ï¼Œå†…æ ¸å°±ä¼šé™åˆ¶è¯¥ç»„è¿›ç¨‹çš„å†…å­˜ã€‚</li>
                        <li>Docker <code>run --memory=100m</code> åº•å±‚å°±æ˜¯æ‰§è¡Œäº†è¿™ä¸ªæ“ä½œã€‚</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

</main>

<script>
    // --- è§†å›¾åˆ‡æ¢é€»è¾‘ ---
    function switchView(viewId) {
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        // æ›´æ–°å†…å®¹åŒºåŸŸ
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.getElementById('view-' + viewId).classList.add('active');
    }

    // --- åˆ†æé¢æ¿é€»è¾‘ ---
    function showAnalysis(id) {
        document.querySelectorAll('.cmd-block').forEach(el => el.classList.remove('selected'));
        document.getElementById('ab-' + id).classList.add('selected');

        document.querySelectorAll('.detail-pane > div').forEach(el => el.style.display = 'none');
        document.getElementById('ad-' + id).style.display = 'block';
    }

    // --- å®éªŒå®¤ (Lab) é€»è¾‘ ---
    let labStep = 0;
    const layers = { l2: 25, l3: 45, l4: 65 };

    function typeWriter(text, element, callback) {
        const line = document.createElement('div');
        line.className = 'term-line';
        // æ„å»ºæç¤ºç¬¦
        let prompt = "root@host:~# ";
        if (labStep >= 3) prompt = "/ # "; // Chroot åæç¤ºç¬¦å˜äº†
        
        line.innerHTML = `<span class="prompt">${prompt}</span><span class="cmd"></span><span class="cursor">&nbsp;</span>`;
        element.appendChild(line);
        element.scrollTop = element.scrollHeight;

        const cmdSpan = line.querySelector('.cmd');
        let i = 0;
        
        // ç§»é™¤æ—§å…‰æ ‡
        const oldCursors = element.querySelectorAll('.cursor');
        if(oldCursors.length > 1) oldCursors[0].remove();

        const interval = setInterval(() => {
            cmdSpan.textContent += text.charAt(i);
            i++;
            if (i > text.length) {
                clearInterval(interval);
                line.querySelector('.cursor').remove(); // ç§»é™¤å½“å‰å…‰æ ‡
                if(callback) callback();
            }
        }, 20);
    }

    function addOutput(text) {
        const div = document.createElement('div');
        div.className = 'output';
        div.innerText = text;
        document.getElementById('lab-term').appendChild(div);
        document.getElementById('lab-term').scrollTop = document.getElementById('lab-term').scrollHeight;
    }

    function runLab(step) {
        if (step <= labStep) return;
        labStep = step;
        
        // UI Button Update
        document.querySelectorAll('.lab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-s' + step).classList.add('active');
        if(step < 5) document.getElementById('btn-s' + (step+1)).disabled = false;

        const term = document.getElementById('lab-term');

        // Logic Switch
        switch(step) {
            case 1: // Download
                typeWriter("wget alpine.tar && tar -xvf alpine.tar -C ./rootfs", term, () => {
                    addOutput("[OK] Downloaded alpine-minirootfs.tar.gz\n[OK] Extracted to ./rootfs/\n -> ./rootfs/bin\n -> ./rootfs/etc");
                    // Anim
                    document.getElementById('l2').style.opacity = 1; 
                    document.getElementById('l2').style.bottom = layers.l2 + "px";
                    setTimeout(() => { document.getElementById('l3').style.opacity = 1; document.getElementById('l3').style.bottom = layers.l3 + "px"; }, 200);
                    setTimeout(() => { document.getElementById('l4').style.opacity = 1; document.getElementById('l4').style.bottom = layers.l4 + "px"; }, 400);
                });
                break;
            case 2: // Namespace
                typeWriter("unshare --pid --net --fork --mount-proc /bin/bash", term, () => {
                    addOutput("[Info] Created new PID Namespace.\n[Info] Created new Network Namespace.\n[Info] Process started.");
                    // Anim
                    document.getElementById('anim-wl').style.opacity = 1;
                    document.getElementById('anim-wl').style.width = "2px";
                    document.getElementById('anim-wr').style.opacity = 1;
                    document.getElementById('anim-wr').style.width = "2px";
                    
                    const proc = document.getElementById('anim-proc');
                    proc.style.transform = "scale(1)";
                });
                break;
            case 3: // Chroot
                typeWriter("chroot ./rootfs /bin/sh", term, () => {
                    addOutput("Root directory changed to ./rootfs.");
                    // Anim
                    document.getElementById('anim-wt').style.opacity = 1;
                    document.getElementById('anim-wt').style.width = "280px";
                    document.getElementById('anim-proc').querySelector('span').innerText = "PID 1";
                });
                break;
            case 4: // Cgroups
                typeWriter("echo 512M > /sys/fs/cgroup/memory/box/memory.limit", term, () => {
                    addOutput("[OK] Cgroup limit applied: 512MB.");
                    // Anim
                    document.getElementById('anim-cgroup').style.opacity = 1;
                    document.getElementById('anim-cgroup').style.transform = "translateX(-50%) translateY(10px)";
                    document.getElementById('anim-proc').style.height = "60px"; // Squeeze effect
                });
                break;
            case 5: // Verify
                typeWriter("ps aux", term, () => {
                    addOutput("PID   USER     TIME  COMMAND\n  1   root     0:00  /bin/sh\n  2   root     0:00  ps aux");
                    addOutput("\nâœ… æ­å–œï¼ä½ å·²æˆåŠŸæ¨¡æ‹Ÿäº† Docker çš„æ ¸å¿ƒå¯åŠ¨è¿‡ç¨‹ï¼");
                });
                break;
        }
    }

    function resetLab() {
        labStep = 0;
        document.getElementById('lab-term').innerHTML = '<div class="term-line">Welcome. è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®...<br>----------------------------------------</div>';
        document.querySelectorAll('.lab-btn').forEach((b, i) => {
            b.classList.remove('active');
            if(i > 0) b.disabled = true; // disable all except first
        });
        document.getElementById('btn-s1').disabled = false;

        // Reset Anim
        document.querySelectorAll('.fs-layer').forEach(l => { 
            if(l.id !== 'l1') { l.style.opacity = 0; l.style.bottom = 0; }
        });
        document.querySelectorAll('.wall').forEach(w => { w.style.opacity = 0; w.style.width = 0; });
        document.getElementById('anim-wt').style.width = 0;
        
        const proc = document.getElementById('anim-proc');
        proc.style.transform = "scale(0)";
        proc.style.height = "70px";
        
        document.getElementById('anim-cgroup').style.opacity = 0;
        document.getElementById('anim-cgroup').style.transform = "translateX(-50%) translateY(-50px)";
    }

</script>

</body>
</html>